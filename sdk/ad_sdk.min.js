const { appId: appId, appSecret: appSecret, appKey: appKey } = require("ad_conf.js"), md5 = require("ad_md5.min.js"); let initData = { appkey: appKey, adslot: "", appid: appId, secret: appSecret, code: "", brand: "", model: "", system: "", city: "", province: "", country: "", gender: "" }, status = { uInfo: !0, sInfo: !0 }; function req(t, e, n) { return new Promise((o, i) => { wx.request({ url: "https://api.koudaihaiwan.com/" + t, data: e, method: n, success: t => { if (200 != t.statusCode) return i(t), !1; o(t.data) }, fail: function (t) { i(t) } }) }) } function login() { return new Promise((t, e) => { wx.login({ success: function (e) { t(e) }, fail: function (t) { console.error(t) } }) }) } function getU() { return new Promise((t, e) => { wx.getSetting({ success: e => { e.authSetting["scope.userInfo"] ? wx.getUserInfo({ success: e => { var n = e.userInfo; initData.city = n.city, initData.province = n.province, initData.country = n.country, initData.gender = n.gender, t(e) }, fail: function (t) { console.error(t) }, complete: function (t) { } }) : (status.uInfo = !1, t(e)) }, fail: function (t) { console.error(t) } }) }) } function getS() { return new Promise((t, e) => { wx.getSystemInfo({ success: e => { initData.brand = e.brand, initData.model = e.model, initData.system = e.system, status.sInfo = !1, t() } }) }) } function objKeySort(t) { for (var e = Object.keys(t).sort(), n = "JTIzQCV1RkYwMSV1ODA1QSV1NzBCOSV1NEU5MiV1NTJBOCV1RYwMUAlMjM=", o = 0; o < e.length; o++)n += e[o] + t[e[o]]; return md5.hexMD5(n) } function init(t, e) { var n, o = {}; return login().then(t => (n = t.code, getU())).then(t => getS()).then(i => (o[e] = Object.assign({}, initData), o[e].adslot = t, o[e].code = n, o[e].sign = objKeySort(o[e]), req("transmit", o[e], "GET"))).then(t => t.data, t => (console.error(t), t)) } function click(t) { wx.request({ url: t, method: "GET", success: function (t) { }, fail: function (t) { } }) } function close(t, e) { e.setData({ [t]: !1 }) } module.exports = { init: init, click: click, close: close };